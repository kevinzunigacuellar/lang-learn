---
import Layout from "../layouts/Layout.astro";
import LoginForm from "../components/LoginForm";
import { auth } from "../lib/firebase/server";
/* Get session cookie */
const sessionCookie = Astro.cookies.get("session").value;
if (sessionCookie) {
  const session = await auth
    .verifySessionCookie(sessionCookie, true)
    .catch((error) => {
      return undefined;
    });
  if (session) {
    return Astro.redirect("/dashboard");
  }
}
---

<Layout title="Sign in">
  <main class="w-full h-full flex flex-col items-center justify-center">
    <section class="w-full max-w-md">
      <h1 class="font-semibold text-2xl text-white w-full mb-1">Sign in</h1>
      <p class="text-zinc-400 text-sm mb-8 w-full">
        New to Astro? <a href="/signup" class="text-blue-400 font-medium"
          >Sign up for an account</a
        >
      </p>
      <LoginForm client:load />
    </section>
  </main>
</Layout>

<!-- <script>
    // Import the functions you need from the SDKs you need
  import { initializeApp } from "firebase/app";
  import { getAuth, onAuthStateChanged, connectAuthEmulator, signInWithEmailAndPassword, EmailAuthCredential } from "firebase/auth";
  import { getFirestore } from "firebase/firestore";

  const loginButton = document.getElementById("loginBtn");
  const emailBox = document.querySelector('#email') as HTMLInputElement;
  const passwordBox = document.getElementById("password") as HTMLInputElement;
  const errorText = document.getElementById("errorMessage")!;


  // Your web app's Firebase configuration
  const firebaseApp = {
    apiKey: "AIzaSyATszqPiuQcEluvSaELG2wqowZHViZWfug",
    authDomain: "language-learner-6f7e2.firebaseapp.com",
    databaseURL: "https://language-learner-6f7e2-default-rtdb.firebaseio.com",
    projectId: "language-learner-6f7e2",
    storageBucket: "language-learner-6f7e2.appspot.com",
    messagingSenderId: "949559927954",
    appId: "1:949559927954:web:b7646c3aa90555e561f24b"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseApp);
  const auth = getAuth(app);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      // User is signed in, see docs for a list of available properties
      // https://firebase.google.com/docs/reference/js/firebase.User
      const uid = user.uid;
        console.log("logged in")
    } else {
      console.log("NOT logged in")
    }
  });

  // connectAuthEmulator(auth, "http://localhost:9099");

  const loginEmailPassword = async () => {
      console.log("loginButton pressed")
      const email = emailBox.value;
      const password = passwordBox.value;
      try {
      const userCredentials = await signInWithEmailAndPassword(auth, email, password);
      console.log(userCredentials.user)
      }
      catch (error) {
          console.log(error)
          errorText.innerHTML = "Invalid email or password"
      }
  };

  if (loginButton === null) throw new Error("loginButton is null");
  else {
    loginButton.addEventListener("click", loginEmailPassword);
    
  }

</script> -->
