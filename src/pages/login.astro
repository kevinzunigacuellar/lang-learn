---
import Layout from "../layouts/Layout.astro";
import LoginForm from "../components/LoginForm";

---

<Layout title="login">
  <div id="login">
    <div class="header">
      <h1>Getting Started with Firebase Auth</h1>
    </div>
    <form>
      <div>
        <input id="email" type="email">
        <label>Email</label>
      </div>
      <div>
        <input id="password" type="password">
        <label>Password</label>
      </div>
      <div id="divLoginError">
        <div id="errorMessage"></div>
      </div>
      <button id="loginBtn" type="button" >Log in</button>
      <button id="signUp" type="button">Sign up</button>
    </form>
  </div>
  
</Layout>

<script>
    // Import the functions you need from the SDKs you need
  import { initializeApp } from "firebase/app";
  import { getAuth, onAuthStateChanged, connectAuthEmulator, signInWithEmailAndPassword, EmailAuthCredential } from "firebase/auth";
  import { getFirestore } from "firebase/firestore";

  const loginButton = document.getElementById("loginBtn");
  const emailBox = document.querySelector('#email') as HTMLInputElement;
  const passwordBox = document.getElementById("password") as HTMLInputElement;
  const errorText = document.getElementById("errorMessage")!;


  // Your web app's Firebase configuration
  const firebaseApp = {
    apiKey: "AIzaSyATszqPiuQcEluvSaELG2wqowZHViZWfug",
    authDomain: "language-learner-6f7e2.firebaseapp.com",
    databaseURL: "https://language-learner-6f7e2-default-rtdb.firebaseio.com",
    projectId: "language-learner-6f7e2",
    storageBucket: "language-learner-6f7e2.appspot.com",
    messagingSenderId: "949559927954",
    appId: "1:949559927954:web:b7646c3aa90555e561f24b"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseApp);
  const auth = getAuth(app);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      // User is signed in, see docs for a list of available properties
      // https://firebase.google.com/docs/reference/js/firebase.User
      const uid = user.uid;
        console.log("logged in")
    } else {
      console.log("NOT logged in")
    }
  });

  // connectAuthEmulator(auth, "http://localhost:9099");

  const loginEmailPassword = async () => {
      console.log("loginButton pressed")
      const email = emailBox.value;
      const password = passwordBox.value;
      try {
      const userCredentials = await signInWithEmailAndPassword(auth, email, password);
      console.log(userCredentials.user)
      }
      catch (error) {
          console.log(error)
          errorText.innerHTML = "Invalid email or password"
      }
  };

  if (loginButton === null) throw new Error("loginButton is null");
  else {
    loginButton.addEventListener("click", loginEmailPassword);
    
  }

</script>
